import{v as de,m as A,n as Y,B as G,o as H,s as J,q as Q,p as $,r as X,l as Z,w as ce}from "./polymorphic-factory-B6DOF3ls.js";import{l as e,r as l}from "./chunk-IR6S3I6Y-dbCMCKTV.js";import{A as ue,T as me}from "./index-CANQhxZI.js";import{S as B,T as h}from "./Stack-KrH3-pZG.js";import{g as fe,a as ee,P as pe,S as ge}from "./Progress-Dw_R5prS.js";import{C as U}from "./Card-BKwfwKec.js";import{G as M}from "./Group-Cj9zz6ZP.js";import{T as he}from "./Title-qjgsItaj.js";import{a as xe,B as O}from "./Button-CXyS1gk-.js";import{P as je}from "./Paper-CeW2lXcr.js";import{d as be,c as ye}from "./Loader-BQHLcVSB.js";import"./create-safe-context-DfDc7BN7.js";import"./DirectionProvider-CWgptujd.js";import"./index-Dmddrpv2.js";var te={root:"m_347db0ec","root--dot":"m_fbd81e3d",label:"m_5add502a",section:"m_91fdda9b"};const ve={},Se=H((s, {radius:a,color:t,gradient:o,variant:n,size:i,autoContrast:d})=>{const m=s.variantColorResolver({color:t||s.primaryColor,theme:s,gradient:o,variant:n||"filled",autoContrast:d});return{root:{"--badge-height":$(i,"badge-height"),"--badge-padding-x":$(i,"badge-padding-x"),"--badge-fz":$(i,"badge-fz"),"--badge-radius":a===void 0?void 0:Q(a),"--badge-bg":t||n?m.background:void 0,"--badge-color":t||n?m.color:void 0,"--badge-bd":t||n?m.border:void 0,"--badge-dot-color":n==="dot"?J(t,s):void 0}}}),W=de((s, a)=>{const t=A("Badge",ve,s),{classNames:o,className:n,style:i,styles:d,unstyled:m,vars:T,radius:k,color:R,gradient:C,leftSection:x,rightSection:f,children:y,variant:w,fullWidth:p,autoContrast:c,circle:E,mod:N,...P}=t,v=Y({name:"Badge",props:t,classes:te,className:n,style:i,classNames:o,styles:d,unstyled:m,vars:T,varsResolver:Se});return e.jsxs(G,{variant:w,mod:[{block:p,circle:E,"with-right-section":!!f,"with-left-section":!!x},N],...v("root",{variant:w}),ref:a,...P,children:[x&&e.jsx("span",{...v("section"),"data-position":"left",children:x}),e.jsx("span",{...v("label"),children:y}),f&&e.jsx("span",{...v("section"),"data-position":"right",children:f})]})});W.classes=te;W.displayName="@mantine/core/Badge";const ke={multiple:!1},se=l.forwardRef((s, a)=>{const{onChange:t,children:o,multiple:n,accept:i,name:d,form:m,resetRef:T,disabled:k,capture:R,inputProps:C,...x}=A("FileButton",ke,s),f=l.useRef(null),y=()=>{var c;!k&&((c=f.current)==null||c.click())},w= c=>{t(n?Array.from(c.currentTarget.files):c.currentTarget.files[0]||null)};return be(T,()=>{f.current&&(f.current.value="")}),e.jsxs(e.Fragment,{children:[o({onClick:y,...x}),e.jsx("input",{style:{display:"none"},type:"file",accept:i,multiple:n,onChange:w,ref:ye(a,f),name:d,form:m,capture:R,...C})]})});se.displayName="@mantine/core/FileButton";function Re(s="top-end", a=0){const t={"--indicator-top":void 0,"--indicator-bottom":void 0,"--indicator-left":void 0,"--indicator-right":void 0,"--indicator-translate-x":void 0,"--indicator-translate-y":void 0},o=X(a),[n,i]=s.split("-");return n==="top"&&(t["--indicator-top"]=o,t["--indicator-translate-y"]="-50%"),n==="middle"&&(t["--indicator-top"]="50%",t["--indicator-translate-y"]="-50%"),n==="bottom"&&(t["--indicator-bottom"]=o,t["--indicator-translate-y"]="50%"),i==="start"&&(t["--indicator-left"]=o,t["--indicator-translate-x"]="-50%"),i==="center"&&(t["--indicator-left"]="50%",t["--indicator-translate-x"]="-50%"),i==="end"&&(t["--indicator-right"]=o,t["--indicator-translate-x"]="50%"),t}var re={root:"m_e5262200",indicator:"m_760d1fb1",processing:"m_885901b1"};const we={position:"top-end",offset:0,inline:!1,withBorder:!1,disabled:!1,processing:!1},Te=H((s, {color:a,position:t,offset:o,size:n,radius:i,zIndex:d,autoContrast:m})=>({root:{"--indicator-color":a?J(a,s):void 0,"--indicator-text-color":fe(m,s)?xe({color:a,theme:s,autoContrast:m}):void 0,"--indicator-size":X(n),"--indicator-radius":i===void 0?void 0:Q(i),"--indicator-z-index":d==null?void 0:d.toString(),...Re(t,o)}})),z=Z((s, a)=>{const t=A("Indicator",we,s),{classNames:o,className:n,style:i,styles:d,unstyled:m,vars:T,children:k,position:R,offset:C,inline:x,label:f,radius:y,color:w,withBorder:p,disabled:c,processing:E,zIndex:N,autoContrast:P,mod:v,...I}=t,F=Y({name:"Indicator",classes:re,props:t,className:n,style:i,classNames:o,styles:d,unstyled:m,vars:T,varsResolver:Te});return e.jsxs(G,{ref:a,...F("root"),mod:[{inline:x},v],...I,children:[!c&&e.jsx(G,{mod:{"with-label":!!f,"with-border":p,processing:E},...F("indicator"),children:f}),k]})});z.classes=re;z.displayName="@mantine/core/Indicator";const Be={},D=Z((s, a)=>{const t=A("TextInput",Be,s);return e.jsx(ee,{component:"input",ref:a,...t,__staticSelector:"TextInput"})});D.classes=ee.classes;D.displayName="@mantine/core/TextInput";const Ce= s=>{const{loadingMessage:a,progressItems:t}=s;return e.jsx(G,{h:"100vh",flex:1,children:e.jsxs("div",{className:"w-full max-w-[500px] text-left mx-auto p-4 bottom-0 mt-auto",children:[e.jsx("p",{className:"text-center mb-1",children:a}),t.map(({file:o,progress:n,total:i}, d)=>e.jsxs(B,{children:[e.jsx(h,{c:"dimmed",children:o}),e.jsx(pe,{value:n},d)]}))]})})},Ne=({messages:s,tps:a,numTokens:t,imageProgress:o,imageGenerationTime:n,isRunning:i})=>e.jsx(h,{ta:"center",children:s.length>0&&e.jsx(e.Fragment,{children:a?e.jsxs(e.Fragment,{children:[!i&&e.jsxs(h,{span:!0,children:["Generated ",t," tokens in"," ",((t||0)/a).toFixed(2)," seconds ("]}),e.jsx(h,{span:!0,children:a.toFixed(2)}),e.jsx(h,{span:!0,className:"text-gray-500 dark:text-gray-300",children:"tokens/second"}),!i&&e.jsx(h,{span:!0,className:"mr-1",children:")."})]}):o&&e.jsx(M,{children:i?e.jsxs(e.Fragment,{children:[e.jsx(h,{span:!0,children:"Generating image..."})," (",e.jsxs(h,{span:!0,className:"font-medium font-mono text-center text-black dark:text-white",children:[(o*100).toFixed(2),"%"]}),e.jsx(h,{span:!0,className:"mr-1",children:")"})]}):e.jsxs(h,{span:!0,children:["Generated image in"," ",((n||0)/1e3).toFixed(2)," ","seconds. "]})})})});function Ee(){const[s,a]=l.useState(),[t,o]=l.useState(null),[n,i]=l.useState(null),[d,m]=l.useState(""),[T,k]=l.useState([]),[R,C]=l.useState(!1),[x,f]=l.useState(""),[y,w]=l.useState(null),[p,c]=l.useState([]),[E,N]=l.useState(null),[P,v]=l.useState(null),[I,F]=l.useState(null),[ne,V]=l.useState(null);function ae(r, j){c(u=>[...u,{role:"user",content:r,image:j??y}]),N(null),C(!0),f(""),w(null),v(null),F(null),V(null)}return l.useEffect(()=>{if(!s){console.log("Initializing worker...");const r=new Worker(new URL("/assets/janus-worker-B6j2seqA.js",import.meta.url),{type:"module"});r.postMessage({type:"check"}),a(r)}},[]),l.useEffect(()=>{console.log("Worker initialized");const r= u=>{switch(u.data.status){case"success":o("idle");break;case"error":i(u.data.data);break;case"loading":o("loading"),m(u.data.data);break;case"initiate":k(b=>[...b,u.data]);break;case"progress":k(b=>b.map(g=>g.file===u.data.file?{...g,...u.data}:g));break;case"done":k(b=>b.filter(g=>g.file!==u.data.file));break;case"ready":o("ready");break;case"start":c(b=>[...b,{role:"assistant",content:""}]);break;case"text-update":const{output:L,tps:_,numTokens:oe}=u.data;N(_||null),v(oe||null),c(b=>{const g=[...b],S=g[g.length-1];return S&&(g[g.length-1]={...S,content:S.content+(L||"")}),g});break;case"image-update":const{blob:q,progress:ie,time:le}=u.data;if(q){const b=URL.createObjectURL(q);c(g=>{const S=[...g],K=S[S.length-1];return K&&(S[S.length-1]={...K,image:b}),S})}else F(ie||null),V(le||null);break;case"complete":C(!1);break}},j= u=>{console.error("Worker error:",u)};return s==null||s.addEventListener("message",r),s==null||s.addEventListener("error",j),()=>{s==null||s.removeEventListener("message",r),s==null||s.removeEventListener("error",j)}},[s]),l.useEffect(()=>{var r;p.filter(j=>j.role==="user").length!==0&&((r=p[p.length-1])==null?void 0:r.role)!=="assistant"&&(N(null),s==null||s.postMessage({type:"generate",data:p}))},[p,R]),e.jsxs(B,{align:"stretch",flex:1,p:0,h:"100%",style:{overflowY:"hidden"},children:[e.jsx(U,{withBorder:!0,children:e.jsxs(B,{flex:1,h:"100%",children:[e.jsxs(M,{justify:"space-between",align:"center",children:[e.jsx(he,{order:4,children:"Multi-Modal LLM"}),e.jsx(Ne,{messages:p,tps:E,numTokens:P,imageProgress:I,imageGenerationTime:ne,isRunning:R,setMessages:c})]}),!R&&p.length>0&&e.jsx(M,{justify:"flex-end",children:e.jsx(O,{className:"underline cursor-pointer",onClick:()=>c([]),children:"Clear"})}),(t===null||t==="idle")&&p.length===0&&e.jsx(M,{children:e.jsx(O,{onClick:()=>{s==null||s.postMessage({type:"load"}),o("loading")},disabled:t===null,children:t===null?"Running feature checks...":"Load model"})})]})}),t==="ready"&&e.jsxs(B,{style:{overflow:"hidden"},gap:"sm",flex:1,children:[e.jsx(ge,{flex:1,h:"100%",children:e.jsx(B,{children:p.map((r, j)=>e.jsx(U,{withBorder:!0,radius:"lg",children:e.jsxs(B,{gap:"md",align:r.role==="user"?"flex-end":"flex-start",children:[e.jsx(W,{children:r.role}),e.jsx(h,{children:r.content}),r.image&&e.jsx("img",{src:r.image,alt:"Generated image",className:`min-w-20 min-h-20 relative p-2 ${r.role==="user"?"w-20 h-20":void 0}`})]})},j))})}),e.jsxs(B,{children:[y&&e.jsx(je,{p:"md",radius:"lg",withBorder:!0,children:e.jsx(z,{children:e.jsx("img",{src:y,alt:"Generated image",style:{objectFit:"cover"},className:"h-20 w-28 border-gray-300/20 hover:border-border-300/30 transition relative -mb-1 rounded-[0.625rem] border-2"})})}),e.jsx(M,{grow:!0,children:e.jsx(D,{size:"lg",placeholder:"Enter your message...",value:x,flex:1,style:{zIndex:1},leftSection:e.jsx(se,{onChange: r=>{if(!r)return;const j=new FileReader;j.onload= u=>{var _;const L=(_=u.target)==null?void 0:_.result;typeof L=="string"&&w(L)},j.readAsDataURL(r)},children: r=>e.jsx(ue,{...r,mx:"md",children:e.jsx(me,{})})}),onKeyDown: r=>{x.length>0&&!R&&r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),ae(x,y))},onChange: r=>f(r.currentTarget.value),disabled:t!=="ready"})})]})]}),t==="loading"&&e.jsx(Ce,{loadingMessage:d,progressItems:T}),n&&e.jsx(U,{withBorder:!0,children:e.jsx(h,{c:"red",children:n})})]})}const qe=ce(function(){return e.jsx(Ee,{})});export{qe as default};
